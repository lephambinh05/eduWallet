<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner Demo - Hybrid Learning Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        /* Course List Section */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .toolbar h2 {
            color: #333;
            margin: 0;
        }
        
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .course-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .course-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .course-card h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.4em;
        }
        
        .course-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .course-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .course-meta span {
            background: #f5f5f5;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #555;
        }
        
        .course-price {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
            font-weight: 600;
        }
        
        .course-link {
            color: #667eea;
            font-size: 0.9em;
            word-break: break-all;
            margin-top: 10px;
            display: block;
        }
        
        /* Video Section */
        .video-section {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #000;
            margin-bottom: 20px;
        }
        
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .course-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .course-info h2 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .course-info p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.show {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }
        
        .loading::after {
            content: '...';
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* Modal for creating course */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-header h2 {
            color: #333;
            margin: 0;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85em;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        /* Video Progress Bar */
        .video-progress {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 25px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 14px;
            color: #666;
        }
        
        .progress-info span:first-child {
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 20px;
        }
        
        .progress-stats {
            display: flex;
            justify-content: space-around;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .progress-stats span {
            font-size: 14px;
            color: #666;
        }
        
        .progress-stats strong {
            color: #f5576c;
            font-weight: 600;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }
        
        .tab-btn:hover {
            background: #f8f9fa;
            color: #f5576c;
        }
        
        .tab-btn.active {
            color: #f5576c;
            border-bottom-color: #f5576c;
            background: linear-gradient(135deg, #f093fb15 0%, #f5576c15 100%);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        /* Quiz Styles */
        .quiz-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .quiz-header {
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
            margin-bottom: 25px;
        }
        
        .quiz-header h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .quiz-stats {
            display: flex;
            gap: 30px;
            font-size: 14px;
            color: #666;
        }
        
        .quiz-stats strong {
            color: #f5576c;
            font-size: 16px;
        }
        
        .quiz-content {
            min-height: 300px;
        }
        
        .question {
            display: none;
        }
        
        .question.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question h4 {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .option:hover {
            border-color: #f5576c;
            background: #fff5f7;
        }
        
        .option.selected {
            border-color: #f5576c;
            background: linear-gradient(135deg, #f093fb15 0%, #f5576c15 100%);
        }
        
        .option.correct {
            border-color: #38ef7d;
            background: #d4edda;
        }
        
        .option.wrong {
            border-color: #f5576c;
            background: #f8d7da;
        }
        
        .quiz-navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .quiz-result {
            text-align: center;
            padding: 40px;
        }
        
        .quiz-result h3 {
            color: #333;
            font-size: 2em;
            margin-bottom: 20px;
        }
        
        .quiz-result .final-score {
            font-size: 4em;
            font-weight: bold;
            color: #f5576c;
            margin: 20px 0;
        }
        
        .quiz-result p {
            font-size: 1.2em;
            color: #666;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>ÔøΩ</span>
                Partner Hybrid Platform
            </h1>
            <p>N·ªÅn t·∫£ng h·ªçc t·∫≠p h·ªón h·ª£p - T√≠ch h·ª£p EduWallet</p>
            <div style="margin-top: 15px;">
                <a href="completed.html" class="btn" style="background: white; color: #4facfe; text-decoration: none; display: inline-block;">
                    üéì Xem kh√≥a h·ªçc ƒë√£ ho√†n th√†nh
                </a>
            </div>
        </div>
        
        <div class="content">
            <!-- Course List Section -->
            <div id="courseListSection" class="section active">
                <div class="toolbar">
                    <h2>Danh s√°ch kh√≥a h·ªçc</h2>
                    <button class="btn btn-success" onclick="showCreateCourseModal()">
                        ‚ûï T·∫°o kh√≥a h·ªçc m·ªõi
                    </button>
                </div>
                
                <div id="messageContainer" class="message"></div>
                
                <div id="coursesContainer" class="loading">
                    ƒêang t·∫£i kh√≥a h·ªçc
                </div>
            </div>
            
            <!-- Hybrid Learning Section (Video + Quiz) -->
            <div id="videoSection" class="section video-section">
                <div id="videoMessage" class="message"></div>
                
                <div id="courseDetails" class="course-info">
                    <!-- Course info will be loaded here -->
                </div>
                
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="switchTab('video', event)">
                        üé• Video b√†i gi·∫£ng
                    </button>
                    <button class="tab-btn" onclick="switchTab('quiz', event)">
                        üìù B√†i ki·ªÉm tra
                    </button>
                </div>
                
                <!-- Video Tab -->
                <div id="videoTab" class="tab-content active">
                    <div class="video-wrapper">
                        <iframe 
                            id="videoPlayer"
                            width="100%" 
                            height="100%" 
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen
                            style="border-radius: 12px;">
                        </iframe>
                    </div>
                    
                    <div class="video-progress">
                        <div class="progress-info">
                            <span id="videoProgressText">Ti·∫øn ƒë·ªô xem video: 0%</span>
                            <span id="timeInfo">0:00 / 0:00</span>
                        </div>
                        <div class="progress-bar" onclick="seekVideoHybrid(event)" style="cursor: pointer;">
                            <div id="videoProgressFill" class="progress-fill"></div>
                        </div>
                        <div class="progress-stats">
                            <span>üìä ƒê√£ xem: <strong id="watchedTime">0 ph√∫t</strong></span>
                            <span>‚è±Ô∏è C√≤n l·∫°i: <strong id="remainingTime">0 ph√∫t</strong></span>
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn btn-success" onclick="markVideoComplete()" id="videoCompleteBtn">
                                ‚úì ƒê√°nh d·∫•u ho√†n th√†nh
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Tab -->
                <div id="quizTab" class="tab-content">
                    <div class="quiz-container">
                        <div class="quiz-header">
                            <h3 id="quizTitle">üìù B√†i ki·ªÉm tra sau h·ªçc</h3>
                            <div class="quiz-stats">
                                <span>C√¢u h·ªèi: <strong id="currentQuestion">1</strong> / <strong id="totalQuestions">5</strong></span>
                                <span>ƒêi·ªÉm: <strong id="score">0</strong></span>
                            </div>
                        </div>
                        
                        <div id="quizContent" class="quiz-content">
                            <!-- Quiz questions will be loaded here -->
                        </div>
                        
                        <div class="quiz-navigation">
                            <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                                ‚Üê C√¢u tr∆∞·ªõc
                            </button>
                            <button class="btn" id="nextBtn" onclick="nextQuestion()">
                                C√¢u ti·∫øp ‚Üí
                            </button>
                            <button class="btn btn-success" id="submitBtn" onclick="submitQuiz()" style="display: none;">
                                ‚úì N·ªôp b√†i
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-progress">
                        <div class="progress-info">
                            <span id="quizProgressText">Ti·∫øn ƒë·ªô l√†m b√†i: 0%</span>
                            <span id="quizTimeInfo">Th·ªùi gian: <span id="timer">00:00</span></span>
                        </div>
                        <div class="progress-bar">
                            <div id="quizProgressFill" class="progress-fill"></div>
                        </div>
                        <div class="progress-stats">
                            <span>üìä ƒê√£ tr·∫£ l·ªùi: <strong id="answeredCount">0/5</strong> c√¢u</span>
                            <span>‚è±Ô∏è ƒêi·ªÉm hi·ªán t·∫°i: <strong id="currentScore">0/100</strong></span>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="backToCourses()">
                        ‚Üê Quay l·∫°i danh s√°ch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Course Modal -->
    <div id="createCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>T·∫°o kh√≥a h·ªçc m·ªõi</h2>
                <button class="close" onclick="closeCreateCourseModal()">&times;</button>
            </div>
            
            <form id="createCourseForm" onsubmit="createCourse(event)">
                <div class="form-group">
                    <label for="courseTitle">Ti√™u ƒë·ªÅ kh√≥a h·ªçc *</label>
                    <input 
                        type="text" 
                        id="courseTitle" 
                        required
                        placeholder="VD: H·ªçc l·∫≠p tr√¨nh Web c∆° b·∫£n"
                    >
                </div>
                
                <div class="form-group">
                    <label for="courseDescription">M√¥ t·∫£</label>
                    <textarea 
                        id="courseDescription"
                        placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ kh√≥a h·ªçc..."
                    ></textarea>
                </div>
                
                <div class="form-group">
                    <label for="courseLink">ƒê∆∞·ªùng d·∫´n kh√≥a h·ªçc *</label>
                    <input 
                        type="text" 
                        id="courseLink" 
                        required
                        placeholder="VD: dev-appt"
                    >
                    <small>ƒê∆∞·ªùng d·∫´n n√†y s·∫Ω ƒë∆∞·ª£c d√πng trong URL: domain.com/<strong>dev-appt</strong>?student=ID</small>
                </div>
                
                <div class="form-group">
                    <label for="coursePrice">Gi√° (EDU) *</label>
                    <input 
                        type="number" 
                        id="coursePrice" 
                        required
                        min="0"
                        step="0.01"
                        placeholder="VD: 50"
                    >
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateCourseModal()">
                        H·ªßy
                    </button>
                    <button type="submit" class="btn btn-success">
                        T·∫°o kh√≥a h·ªçc
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuration - will be loaded from server
        let BACKEND_URL = 'http://localhost:3001';
        let PARTNER_JWT_TOKEN = null;
        let PARTNER_ID = null;
        
        // Get student ID from URL parameter or use default
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('student') || '690302badd7c9774cfd2a6a7';
        
        let currentCourse = null;
        
        // Load partner configuration from server
        async function loadConfig() {
            try {
                const response = await fetch('/config');
                const config = await response.json();
                
                BACKEND_URL = config.backendUrl;
                PARTNER_JWT_TOKEN = config.jwtToken;
                PARTNER_ID = config.partnerId;
                
                console.log('‚úÖ Partner config loaded:', config.partnerId);
                return true;
            } catch (error) {
                console.error('‚ùå Error loading config:', error);
                showMessage('messageContainer', 'L·ªói t·∫£i c·∫•u h√¨nh. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
                return false;
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // Load config first
            const configLoaded = await loadConfig();
            
            if (configLoaded) {
                // Then load courses
                loadCourses();
            }
            
            // If student ID in URL, we could auto-enroll or show student info
            if (studentId) {
                console.log('Student ID from URL:', studentId);
                showMessage('messageContainer', `üë§ Student ID: ${studentId}`, 'success');
            }
        });

        // Load courses from backend Partner API
        async function loadCourses() {
            const container = document.getElementById('coursesContainer');
            container.innerHTML = '<div class="loading">ƒêang t·∫£i kh√≥a h·ªçc</div>';
            
            if (!PARTNER_JWT_TOKEN) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå L·ªói c·∫•u h√¨nh</h3>
                        <p>Kh√¥ng t√¨m th·∫•y JWT token</p>
                    </div>
                `;
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/partner/courses`, {
                    headers: {
                        'Authorization': `Bearer ${PARTNER_JWT_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.courses) {
                    displayCourses(data.data.courses);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>üìö Ch∆∞a c√≥ kh√≥a h·ªçc n√†o</h3>
                            <p>Nh·∫•n n√∫t "T·∫°o kh√≥a h·ªçc m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading courses:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå L·ªói t·∫£i kh√≥a h·ªçc</h3>
                        <p>${error.message}</p>
                        <button class="btn" onclick="loadCourses()">Th·ª≠ l·∫°i</button>
                    </div>
                `;
            }
        }

        // Display courses in grid
        function displayCourses(courses) {
            const container = document.getElementById('coursesContainer');
            
            if (!courses || courses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üìö Ch∆∞a c√≥ kh√≥a h·ªçc n√†o</h3>
                        <p>Nh·∫•n n√∫t "T·∫°o kh√≥a h·ªçc m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
                    </div>
                `;
                return;
            }
            
            const grid = document.createElement('div');
            grid.className = 'courses-grid';
            
            courses.forEach(course => {
                const card = document.createElement('div');
                card.className = 'course-card';
                
                // Build URL with student parameter
                const courseUrl = buildCourseUrl(course.link, studentId);
                
                card.innerHTML = `
                    <h3>${course.title}</h3>
                    <p>${course.description || 'Ch∆∞a c√≥ m√¥ t·∫£'}</p>
                    <div class="course-meta">
                        <span class="course-price">üí∞ ${course.priceEdu} EDU</span>
                        <span>üìÖ ${new Date(course.createdAt).toLocaleDateString('vi-VN')}</span>
                    </div>
                    ${courseUrl ? `<a class="course-link" href="${courseUrl}" target="_blank">üîó ${courseUrl}</a>` : ''}
                `;
                
                // Click to view course details (if you want to show video)
                card.onclick = () => selectCourse(course);
                
                grid.appendChild(card);
            });
            
            container.innerHTML = '';
            container.appendChild(grid);
        }

        // Build course URL with student parameter
        function buildCourseUrl(coursePath, studentId) {
            if (!coursePath) return null;
            
            const domain = window.location.hostname;
            const port = window.location.port ? `:${window.location.port}` : '';
            let url = `${window.location.protocol}//${domain}${port}/${coursePath}`;
            
            if (studentId) {
                url += `?student=${studentId}`;
            }
            
            return url;
        }

        // Select and view a course
        function selectCourse(course) {
            currentCourse = course;
            
            // YouTube video playlist for Website 3
            const videoPlaylist = [
                'https://www.youtube.com/embed/UBUNrFtufWo',
                'https://www.youtube.com/embed/Tn6-PIqc4UM', // React in 100 seconds
                'https://www.youtube.com/embed/gieEQFIfgYc', // Node.js Tutorial
                'https://www.youtube.com/embed/pKd0Rpw7O48', // JavaScript ES6
                'https://www.youtube.com/embed/qwfE7fSVaZM'  // Git Tutorial
            ];
            
            // Random video from playlist
            const randomVideo = videoPlaylist[Math.floor(Math.random() * videoPlaylist.length)];
            
            // Display course info
            document.getElementById('courseDetails').innerHTML = `
                <h2>${course.title}</h2>
                <p><strong>M√¥ t·∫£:</strong> ${course.description || 'Ch∆∞a c√≥ m√¥ t·∫£'}</p>
                <p><strong>Gi√°:</strong> ${course.priceEdu} EDU</p>
                <p><strong>ƒê∆∞·ªùng d·∫´n:</strong> ${course.link}</p>
                ${studentId ? `<p><strong>Student ID:</strong> ${studentId}</p>` : ''}
            `;
            
            // Load YouTube video
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.src = randomVideo + '?autoplay=0&rel=0';
            
            // Initialize both video player and quiz
            initializeVideoPlayer();
            initializeQuiz();
            
            showSection('videoSection');
        }
        
        // Tab switching
        let currentTab = 'video';
        function switchTab(tabName, event) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'video') {
                document.getElementById('videoTab').classList.add('active');
            } else {
                document.getElementById('quizTab').classList.add('active');
            }
        }
        
        // Initialize video player and progress tracking
        function initializeVideoPlayer() {
            let watchTime = 0;
            let totalTime = 600; // 10 minutes per video
            let isCompleted = false;
            
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgressText');
            const timeInfo = document.getElementById('timeInfo');
            const watchedTime = document.getElementById('watchedTime');
            const remainingTime = document.getElementById('remainingTime');
            const completeBtn = document.getElementById('videoCompleteBtn');
            
            // Clear previous interval
            if (window.videoProgressInterval3) {
                clearInterval(window.videoProgressInterval3);
            }
            
            // Reset progress
            watchTime = 0;
            isCompleted = false;
            progressFill.style.width = '0%';
            progressText.textContent = 'Ti·∫øn ƒë·ªô xem video: 0%';
            if (completeBtn) {
                completeBtn.disabled = false;
                completeBtn.textContent = '‚úì ƒê√°nh d·∫•u ho√†n th√†nh';
                completeBtn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            }
            
            // Store current time globally
            window.currentVideoTime3 = 0;
            window.totalVideoTime3 = totalTime;
            
            // Update progress every second
            window.videoProgressInterval3 = setInterval(() => {
                if (!isCompleted) {
                    watchTime++;
                    window.currentVideoTime3 = watchTime;
                    
                    const progress = (watchTime / totalTime) * 100;
                    progressFill.style.width = Math.min(progress, 100) + '%';
                    progressText.textContent = `Ti·∫øn ƒë·ªô xem video: ${Math.min(Math.round(progress), 100)}%`;
                    
                    // Format time
                    const currentMin = Math.floor(watchTime / 60);
                    const currentSec = watchTime % 60;
                    const durationMin = Math.floor(totalTime / 60);
                    const durationSec = totalTime % 60;
                    
                    timeInfo.textContent = `${currentMin}:${currentSec.toString().padStart(2, '0')} / ${durationMin}:${durationSec.toString().padStart(2, '0')}`;
                    
                    // Update stats
                    watchedTime.textContent = `${currentMin} ph√∫t ${currentSec} gi√¢y`;
                    const remaining = totalTime - watchTime;
                    const remainingMin = Math.floor(remaining / 60);
                    const remainingSec = remaining % 60;
                    remainingTime.textContent = `${remainingMin} ph√∫t ${remainingSec} gi√¢y`;
                    
                    // Auto complete when reach end
                    if (watchTime >= totalTime) {
                        markVideoComplete();
                    }
                }
            }, 1000);
        }
        
        // Seek video by clicking on progress bar
        function seekVideoHybrid(event) {
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            const totalTime = window.totalVideoTime3 || 600;
            const newTime = Math.floor(totalTime * percentage);
            
            window.currentVideoTime3 = newTime;
            
            // Update UI immediately
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgressText');
            const timeInfo = document.getElementById('timeInfo');
            const watchedTime = document.getElementById('watchedTime');
            const remainingTime = document.getElementById('remainingTime');
            
            const progress = (newTime / totalTime) * 100;
            progressFill.style.width = Math.min(progress, 100) + '%';
            progressText.textContent = `Ti·∫øn ƒë·ªô xem video: ${Math.min(Math.round(progress), 100)}%`;
            
            const currentMin = Math.floor(newTime / 60);
            const currentSec = newTime % 60;
            const durationMin = Math.floor(totalTime / 60);
            const durationSec = totalTime % 60;
            
            timeInfo.textContent = `${currentMin}:${currentSec.toString().padStart(2, '0')} / ${durationMin}:${durationSec.toString().padStart(2, '0')}`;
            watchedTime.textContent = `${currentMin} ph√∫t ${currentSec} gi√¢y`;
            
            const remaining = totalTime - newTime;
            const remainingMin = Math.floor(remaining / 60);
            const remainingSec = remaining % 60;
            remainingTime.textContent = `${remainingMin} ph√∫t ${remainingSec} gi√¢y`;
        }
        
        // Mark video as complete
        async function markVideoComplete() {
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgressText');
            const completeBtn = document.getElementById('videoCompleteBtn');
            
            // Set to 100%
            progressFill.style.width = '100%';
            progressText.textContent = 'Ti·∫øn ƒë·ªô xem video: 100% - ƒê√£ ho√†n th√†nh!';
            
            // Update button
            if (completeBtn) {
                completeBtn.disabled = true;
                completeBtn.textContent = '‚úì ƒêang l∆∞u...';
            }
            
            // Clear interval
            if (window.videoProgressInterval3) {
                clearInterval(window.videoProgressInterval3);
            }
            
            // Save to database
            try {
                const timeSpent = window.currentVideoTime3 || 600;
                const response = await fetch(`${BACKEND_URL}/api/partner/courses/${currentCourse._id}/progress`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        studentId: studentId,
                        progressPercent: 100,
                        timeSpentSeconds: timeSpent,
                        completed: true
                        // No quizScore for video - backend will default to 100
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (completeBtn) {
                        completeBtn.textContent = '‚úì ƒê√£ ho√†n th√†nh';
                        completeBtn.style.background = '#6c757d';
                    }
                    showMessage('videoMessage', 'üéâ Ch√∫c m·ª´ng! ƒê√£ l∆∞u ti·∫øn tr√¨nh ho√†n th√†nh v√†o h·ªá th·ªëng!', 'success');
                } else {
                    throw new Error(data.message || 'Failed to save progress');
                }
            } catch (error) {
                console.error('Error saving progress:', error);
                if (completeBtn) {
                    completeBtn.textContent = '‚úó L·ªói l∆∞u';
                    completeBtn.style.background = '#dc3545';
                }
                showMessage('videoMessage', '‚ùå L·ªói khi l∆∞u ti·∫øn tr√¨nh. Vui l√≤ng th·ª≠ l·∫°i!', 'error');
                setTimeout(() => {
                    if (completeBtn) {
                        completeBtn.disabled = false;
                        completeBtn.textContent = '‚úì Th·ª≠ l·∫°i';
                        completeBtn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                    }
                }, 3000);
                return;
            }
            
            setTimeout(() => {
                const msg = document.getElementById('videoMessage');
                if (msg) msg.classList.remove('show');
            }, 5000);
        }
        
        // Quiz data and state
        let quizData = [
            {
                question: "1. React l√† g√¨?",
                options: [
                    "M·ªôt framework backend",
                    "M·ªôt th∆∞ vi·ªán JavaScript ƒë·ªÉ x√¢y d·ª±ng UI",
                    "M·ªôt ng√¥n ng·ªØ l·∫≠p tr√¨nh",
                    "M·ªôt c∆° s·ªü d·ªØ li·ªáu"
                ],
                correct: 1
            },
            {
                question: "2. Node.js ƒë∆∞·ª£c x√¢y d·ª±ng tr√™n engine n√†o?",
                options: [
                    "SpiderMonkey",
                    "JavaScriptCore",
                    "V8",
                    "Chakra"
                ],
                correct: 2
            },
            {
                question: "3. MongoDB l√† lo·∫°i c∆° s·ªü d·ªØ li·ªáu g√¨?",
                options: [
                    "SQL",
                    "NoSQL",
                    "Graph Database",
                    "Time Series Database"
                ],
                correct: 1
            },
            {
                question: "4. RESTful API s·ª≠ d·ª•ng giao th·ª©c n√†o?",
                options: [
                    "FTP",
                    "SMTP",
                    "HTTP/HTTPS",
                    "WebSocket"
                ],
                correct: 2
            },
            {
                question: "5. JWT vi·∫øt t·∫Øt c·ªßa t·ª´ g√¨?",
                options: [
                    "JavaScript Web Token",
                    "JSON Web Token",
                    "Java Web Token",
                    "JSON Web Transfer"
                ],
                correct: 1
            }
        ];
        
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizScore = 0;
        let startTime = Date.now();
        let timerInterval;
        
        // Initialize quiz
        function initializeQuiz() {
            currentQuestionIndex = 0;
            userAnswers = new Array(quizData.length).fill(null);
            quizScore = 0;
            startTime = Date.now();
            
            document.getElementById('totalQuestions').textContent = quizData.length;
            document.getElementById('currentQuestion').textContent = '1';
            document.getElementById('score').textContent = '0';
            
            // Start timer
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
            
            // Render first question
            renderQuestion();
            updateQuizProgress();
        }
        
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function renderQuestion() {
            const question = quizData[currentQuestionIndex];
            const quizContent = document.getElementById('quizContent');
            
            quizContent.innerHTML = `
                <div class="question active">
                    <h4>${question.question}</h4>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option ${userAnswers[currentQuestionIndex] === index ? 'selected' : ''}" 
                                 onclick="selectAnswer(${index})">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').style.display = 
                currentQuestionIndex === quizData.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = 
                currentQuestionIndex === quizData.length - 1 ? 'inline-block' : 'none';
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
        }
        
        function selectAnswer(optionIndex) {
            userAnswers[currentQuestionIndex] = optionIndex;
            renderQuestion();
            updateQuizProgress();
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }
        
        function updateQuizProgress() {
            const answered = userAnswers.filter(a => a !== null).length;
            const progress = (answered / quizData.length) * 100;
            
            document.getElementById('quizProgressFill').style.width = progress + '%';
            document.getElementById('quizProgressText').textContent = `Ti·∫øn ƒë·ªô l√†m b√†i: ${Math.round(progress)}%`;
            document.getElementById('answeredCount').textContent = `${answered}/${quizData.length}`;
        }
        
        async function submitQuiz() {
            if (timerInterval) clearInterval(timerInterval);
            
            // Calculate score
            quizScore = 0;
            quizData.forEach((q, index) => {
                if (userAnswers[index] === q.correct) {
                    quizScore += 20; // 20 points per correct answer
                }
            });
            
            // Show loading
            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = `
                <div class="quiz-result">
                    <h3>‚è≥ ƒêang l∆∞u k·∫øt qu·∫£...</h3>
                </div>
            `;
            
            // Save to database
            try {
                const response = await fetch(`${BACKEND_URL}/api/partner/courses/${currentCourse._id}/progress`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        studentId: studentId,
                        progressPercent: 100,
                        timeSpentSeconds: Math.floor((Date.now() - startTime) / 1000),
                        completed: true,
                        quizScore: quizScore
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'Failed to save quiz result');
                }
                
                // Show results
                quizContent.innerHTML = `
                    <div class="quiz-result">
                        <h3>üéâ Ho√†n th√†nh b√†i ki·ªÉm tra!</h3>
                        <div class="final-score">${quizScore}/100</div>
                        <p>B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${quizScore/20} / ${quizData.length} c√¢u</p>
                        <p>Th·ªùi gian l√†m b√†i: ${document.getElementById('timer').textContent}</p>
                        <p>${quizScore >= 80 ? 'üåü Xu·∫•t s·∫Øc!' : quizScore >= 60 ? 'üëç Kh√° t·ªët!' : 'üí™ C·ªë g·∫Øng th√™m!'}</p>
                        <p style="margin-top: 20px; color: #f5576c; font-weight: 600;">‚úì K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o h·ªá th·ªëng!</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error saving quiz result:', error);
                quizContent.innerHTML = `
                    <div class="quiz-result">
                        <h3>‚ùå L·ªói khi l∆∞u k·∫øt qu·∫£!</h3>
                        <p>${error.message}</p>
                        <button class="btn" onclick="submitQuiz()">Th·ª≠ l·∫°i</button>
                    </div>
                `;
                return;
            }
            
            document.getElementById('score').textContent = quizScore;
            document.getElementById('currentScore').textContent = `${quizScore}/100`;
            document.getElementById('quizProgressFill').style.width = '100%';
            document.getElementById('quizProgressText').textContent = 'Ho√†n th√†nh: 100%';
            
            // Hide navigation buttons
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'none';
        }

        // Create new course
        async function createCourse(event) {
            event.preventDefault();
            
            const title = document.getElementById('courseTitle').value.trim();
            const description = document.getElementById('courseDescription').value.trim();
            const link = document.getElementById('courseLink').value.trim();
            const priceEdu = parseFloat(document.getElementById('coursePrice').value);
            
            if (!title || !link || isNaN(priceEdu)) {
                showMessage('messageContainer', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/partner/courses`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${PARTNER_JWT_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title,
                        description,
                        link,
                        priceEdu
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('messageContainer', '‚úÖ T·∫°o kh√≥a h·ªçc th√†nh c√¥ng!', 'success');
                    closeCreateCourseModal();
                    
                    // Reset form
                    document.getElementById('createCourseForm').reset();
                    
                    // Reload courses
                    setTimeout(() => {
                        loadCourses();
                    }, 1000);
                } else {
                    showMessage('messageContainer', '‚ùå ' + (data.message || 'L·ªói t·∫°o kh√≥a h·ªçc'), 'error');
                }
            } catch (error) {
                console.error('Error creating course:', error);
                showMessage('messageContainer', '‚ùå L·ªói k·∫øt n·ªëi: ' + error.message, 'error');
            }
        }

        // Modal functions
        function showCreateCourseModal() {
            document.getElementById('createCourseModal').classList.add('show');
        }

        function closeCreateCourseModal() {
            document.getElementById('createCourseModal').classList.remove('show');
        }

        // Navigation functions
        function backToCourses() {
            currentCourse = null;
            showSection('courseListSection');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        function showMessage(elementId, message, type) {
            const messageEl = document.getElementById(elementId);
            messageEl.textContent = message;
            messageEl.className = `message ${type} show`;
            
            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('createCourseModal');
            if (event.target == modal) {
                closeCreateCourseModal();
            }
        }
    </script>
</body>
</html>
